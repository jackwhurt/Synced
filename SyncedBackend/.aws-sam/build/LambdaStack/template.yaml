AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: Stack for Collaborative Playlists
Parameters:
  UsersTableName:
    Type: String
  CollaborativePlaylistTableName:
    Type: String
Resources:
  GetAllCollaborativePlaylistsFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: services/collaborative-playlists-service/get-all-collaborative-playlists.getAllCollaborativePlaylistsHandler
      Runtime: nodejs18.x
      Architectures:
      - x86_64
      MemorySize: 128
      Timeout: 100
      Description: A function to get all the Collaborative Playlists for a given user.
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: CollaborativePlaylistTableName
      Environment:
        Variables:
          COLLABORATIVE_PLAYLISTS_TABLE:
            Ref: CollaborativePlaylistTableName
      CodeUri: GetAllCollaborativePlaylistsFunction
    Metadata:
      SamResourceId: GetAllCollaborativePlaylistsFunction
  CognitoTriggerFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: services/users-service/add-user.addUserHandler
      Runtime: nodejs18.x
      Architectures:
      - x86_64
      MemorySize: 128
      Timeout: 100
      Description: A function to add new Cognito users to the Users database.
      Policies:
      - DynamoDBCrudPolicy:
          TableName:
            Ref: UsersTableName
      Environment:
        Variables:
          USERS_TABLE:
            Ref: UsersTableName
      CodeUri: CognitoTriggerFunction
    Metadata:
      SamResourceId: CognitoTriggerFunction
Outputs:
  GetAllCollaborativePlaylistsFunctionArn:
    Value:
      Fn::GetAtt:
      - GetAllCollaborativePlaylistsFunction
      - Arn
  CognitoTriggerFunctionArn:
    Value:
      Fn::GetAtt:
      - CognitoTriggerFunction
      - Arn
