AWSTemplateFormatVersion: '2010-09-09'
Description: Main Stack for SyncedBackend

Resources:
  DatabaseStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: 'shared/database.yaml'

  ApiGatewayStack:
      Type: AWS::CloudFormation::Stack
      Properties:
        TemplateURL: 'shared/api.yaml'

  CollaborativePlaylistsStack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: 'services/collaborative-playlists-service/template.yaml'
      Parameters:
        CollaborativePlaylistTableName: !GetAtt DatabaseStack.Outputs.CollaborativePlaylistTableName
        RestApiId: !GetAtt ApiGatewayStack.Outputs.ApiGatewayRestApiId

  # Define the deployment for the API Gateway
  ApiGatewayDeployment:
    Type: AWS::ApiGateway::Deployment
    Properties:
      RestApiId: !GetAtt ApiGatewayStack.Outputs.ApiGatewayRestApiId
      # The StageName is set directly on the Deployment resource.
      # For more control, you can create an AWS::ApiGateway::Stage resource
      StageName: dev
      Description: 'Deployment for the development stage'
